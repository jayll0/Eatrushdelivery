<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Tambah Menu Baru</title>
<style>
  /* CSS SAMA PERSIS DENGAN YANG ANDA KIRIM */
  * { 
    box-sizing: border-box; 
    margin:0; padding:0; 
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
  }

  body { 
    background:#FFFDF5; 
    display:flex; 
    justify-content:center; 
    align-items:flex-start; 
    min-height:100vh; 
    padding:40px 0; 
  }

  .screen {
    width:320px;
    min-height:100vh;
    padding:24px 20px 32px;
    text-align:center;
    background: transparent;
  }

  .header { 
    display:flex; 
    align-items:center; 
    margin-bottom:28px; 
  }

  .back-btn {
        top: 15px;
        left: 15px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        z-index: 40;
        text-decoration: none;
        color: #333;
        backdrop-filter: blur(4px)
    }

  .header-title { 
    font-size:13px; 
    font-weight:500; 
    color:#555; 
    margin-left: 12px;
  }

  .avatar-wrapper { 
    display:flex; 
    justify-content:center; 
    margin-bottom:24px; 
  }
  .avatar {
    width:160px;
    height:160px;
    border-radius:50%;
    border:2px solid #FF7A1A;
    overflow:hidden;
    display:inline-grid;
    place-items:center;
    position:relative;
    background: #fff;
    cursor:pointer;
  }
  .avatar-img {
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .avatar-overlay {
    position:absolute;
    bottom:8px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.45);
    color:#fff;
    font-size:12px;
    padding:6px 10px;
    border-radius:12px;
    pointer-events:none;
  }
  .avatar input[type="file"] { 
    display:none; 
  }

  .form-group { 
    margin-bottom:20px; 
    text-align: left;
  }
  .form-label { 
    font-size:11px;
    letter-spacing:0.04em; 
    font-weight:500; 
    color:#555; 
    margin-bottom:6px; 
    text-transform:uppercase; 
    display: block;
  }
  .form-control { 
    width:100%; 
    padding:12px 14px; 
    border-radius:8px; 
    border:none; 
    outline:none; 
    background:#F2F6FF; 
    font-size:13px; 
    color:#333; 
  }
  
  select.form-control {
      appearance: none;
      background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='gray' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 16px;
  }

  .btn-submit { 
    width:100%; 
    padding:14px 0; 
    margin-top:28px; 
    border:none; 
    border-radius:8px; 
    background:#FFA000; 
    color:#fff; 
    font-weight:600; 
    font-size:14px; 
    cursor:pointer; 
    box-shadow:0 4px 10px rgba(255,160,0,0.4); 
  }
  .btn-submit:active {
     transform:scale(0.98); 
  }

  .alert {
      padding: 10px;
      margin-bottom: 15px;
      border-radius: 8px;
      font-size: 12px;
      text-align: center;
  }
  .alert-error { background: #fee2e2; color: #b91c1c; }
  .alert-success { background: #dcfce7; color: #15803d; }
  
  .error-js { 
    color:#b00020; 
    font-size:12px; 
    margin-top:8px; 
    text-align:center; 
    display:none; 
  }
</style>
</head>
<body>
  <div class="screen">
    <div class="header">
      <a href="javascript:history.back();" onclick="history.back()" class="back-btn">‚Üê</a>
      <div class="header-title">Tambah Menu Baru</div>
    </div>

    <form action="{{ url_for('warung.tambah_makanan_submit') }}" 
          method="POST" 
          enctype="multipart/form-data">
        
        <div class="avatar-wrapper">
          <label class="avatar" title="Upload foto makanan">
            <img id="preview" src="https://placehold.co/160x160/png?text=Upload+Foto" alt="foto" class="avatar-img">
            
            <div class="avatar-overlay">Upload</div>
            <input type="file" id="fileInput" name="gambar" accept="image/*">
          </label>
        </div>
        
        <div id="js-error" class="error-js"></div>

        <div class="form-group">
          <label class="form-label">Nama Makanan</label>
          <input class="form-control" type="text" name="nama" placeholder="Contoh: Nasi Goreng Spesial" required />
        </div>

        <div class="form-group">
          <label class="form-label">Harga (Rp)</label>
          <input class="form-control" type="number" name="harga" placeholder="0" required />
        </div>

        <div class="form-group">
          <label class="form-label">Stok Harian</label>
          <input class="form-control" type="number" name="stok" placeholder="0" required />
        </div>

        <div class="form-group">
            <label class="form-label">Deskripsi</label>
            <textarea class="form-control" name="deskripsi" rows="3" placeholder="Jelaskan detail menu..."></textarea>
        </div>

        <button type="submit" class="btn-submit">TAMBAH MENU</button>
    </form>
  </div>

<script>
  const fileInput = document.getElementById('fileInput');
  const preview = document.getElementById('preview');
  const errorEl = document.getElementById('js-error');

  const MAX_SIZE = 2 * 1024 * 1024; // 2MB
  const allowedMime = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];

  fileInput.addEventListener('change', (e) => {
    errorEl.style.display = 'none';
    const file = e.target.files && e.target.files[0];
    if (!file) return;

    // Validasi Ukuran
    if (file.size > MAX_SIZE) {
      errorEl.textContent = 'Ukuran file terlalu besar. Maks 2 MB.';
      errorEl.style.display = 'block';
      fileInput.value = ''; 
      preview.src = "https://placehold.co/160x160/png?text=Upload+Foto"; // Reset preview
      return;
    }

    // Validasi Tipe
    if (!allowedMime.includes(file.type)) {
      errorEl.textContent = 'Tipe file tidak didukung. Gunakan JPG/PNG/WebP.';
      errorEl.style.display = 'block';
      fileInput.value = '';
      preview.src = "https://placehold.co/160x160/png?text=Upload+Foto"; // Reset preview
      return;
    }

    // Preview gambar
    const reader = new FileReader();
    reader.onload = function () {
      preview.src = reader.result;
    };
    reader.readAsDataURL(file);
  });
</script>
</body>
</html>