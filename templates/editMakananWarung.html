<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Edit Makanan</title>
<style>
  * { 
    box-sizing: border-box; 
    margin:0; padding:0; 
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
  }

  body { 
    background:#FFFDF5; 
    display:flex; 
    justify-content:center; 
    align-items:flex-start; 
    min-height:100vh; 
    padding:40px 0; 
  }

  .screen {
    width:320px;
    min-height:100vh;
    padding:24px 20px 32px;
    text-align:center;
    background: transparent;
  }

  .header { 
    display:flex; 
    align-items:center; 
    margin-bottom:28px; 
}

  .back-btn { 
    width:32px; 
    height:32px; 
    border-radius:50%; 
    border:none; 
    background:#f2f3f7; 
    font-size:18px; 
    cursor:pointer; 
    box-shadow:0 2px 6px rgba(0,0,0,0.04); 
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    color: black;
  }

  .header-title { 
    font-size:13px; 
    font-weight:500; 
    color:#555; 
}

  .avatar-wrapper { 
    display:flex; 
    justify-content:center; 
    margin-bottom:24px; 
}
  .avatar {
    width:160px;
    height:160px;
    border-radius:50%;
    border:2px solid #FF7A1A;
    overflow:hidden;
    display:inline-grid;
    place-items:center;
    position:relative;
    background: #fff;
    cursor:pointer;
  }
  .avatar-img {
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .avatar-overlay {
    position:absolute;
    bottom:8px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.45);
    color:#fff;
    font-size:12px;
    padding:6px 10px;
    border-radius:12px;
    pointer-events:none;
  }
  .avatar input[type="file"] { 
    display:none; 
    }

  .form-group { 
    margin-bottom:20px; 
    }
  .form-label { 
    font-size:11px;
    letter-spacing:0.04em; 
    font-weight:500; 
    color:#555; 
    margin-bottom:6px; 
    text-transform:uppercase; 
}
  .form-control { 
    width:100%; 
    padding:12px 14px; 
    border-radius:8px; 
    border:none; 
    outline:none; 
    background:#F2F6FF; 
    font-size:13px; 
    color:#555; 
}

  .btn-submit { 
    width:100%; 
    padding:14px 0; 
    margin-top:28px; 
    border:none; 
    border-radius:8px; 
    background:#FFA000; 
    color:#fff; 
    font-weight:600; 
    font-size:14px; 
    cursor:pointer; 
    box-shadow:0 4px 10px rgba(255,160,0,0.4); 
}
  .btn-submit:active {
     transform:scale(0.98); 
    }

  .error { 
    color:#b00020; 
    font-size:12px; 
    margin-top:8px; 
    text-align:center; 
    display:none; 
    }
</style>
</head>
<body>
  <div class="screen">

    <div class="header">
      <a href="{{ url_for('warung.home_warung') }}" class="back-btn">‚Üê</a>
      <div class="header-title">Edit Makanan</div>
    </div>

    <form action="{{ url_for('warung.makanan_edit', id_m=makanan.get_id_makanan()) }}" 
          method="POST" 
          enctype="multipart/form-data">
        
        <div class="avatar-wrapper">
          <label class="avatar" title="Klik untuk ganti foto">
            <img id="preview" src="{{ gambar_url }}" alt="foto makanan" class="avatar-img" 
                 onerror="this.src='{{ url_for('static', filename='img/noimage.png') }}'">
            
            <div class="avatar-overlay">Ganti</div>
            <input type="file" id="fileInput" name="gambar" accept="image/*">
          </label>
        </div>
        
        <div id="js-error" class="error"></div>

        <div class="form-group">
          <div class="form-label">Nama makanan</div>
          <input class="form-control" type="text" name="nama" value="{{ makanan.get_nama_makanan() }}" required />
        </div>

        <div class="form-group">
          <div class="form-label">Harga makanan</div>
          <input class="form-control" type="number" name="harga" value="{{ makanan.get_harga_makanan() | int }}" required />
        </div>

        <div class="form-group">
          <div class="form-label">Stok per hari</div>
          <input class="form-control" type="number" name="stok" value="{{ makanan.get_stok_makanan() }}" required />
        </div>

        <div class="form-group">
            <div class="form-label">Deskripsi</div>
            <textarea class="form-control" name="deskripsi" rows="3">{{ makanan.get_deskripsi_makanan() }}</textarea>
        </div>

        <button type="submit" class="btn-submit">SIMPAN PERUBAHAN</button>
    </form>
  </div>

<script>
  const fileInput = document.getElementById('fileInput');
  const preview = document.getElementById('preview');
  const errorEl = document.getElementById('js-error');

  const MAX_SIZE = 2 * 1024 * 1024; // 2MB
  const allowedMime = ['image/jpeg', 'image/png', 'image/webp', 'image/gif'];

  fileInput.addEventListener('change', (e) => {
    errorEl.style.display = 'none';
    const file = e.target.files && e.target.files[0];
    if (!file) return;

    if (file.size > MAX_SIZE) {
      errorEl.textContent = 'Ukuran file terlalu besar. Maks 2 MB.';
      errorEl.style.display = 'block';
      fileInput.value = ''; // Reset input
      return;
    }

    if (!allowedMime.includes(file.type)) {
      errorEl.textContent = 'Tipe file tidak didukung. Gunakan JPG/PNG/WebP.';
      errorEl.style.display = 'block';
      fileInput.value = '';
      return;
    }

    // Preview gambar di browser sebelum di-upload
    const reader = new FileReader();
    reader.onload = function () {
      preview.src = reader.result;
    };
    reader.readAsDataURL(file);
  });
</script>
</body>
</html>
