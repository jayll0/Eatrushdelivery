<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Edit Profile</title>
<style>
  * { 
    box-sizing: border-box; 
    margin:0; padding:0; 
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; 
  }

  body { 
    background:#FFFDF5; 
    display:flex; 
    justify-content:center; 
    align-items:flex-start; 
    min-height:100vh; 
    padding:40px 0; 
  }

  .screen {
    width:320px;
    min-height:100vh;
    padding:24px 20px 32px;
    text-align:center;
    background: transparent;
  }

  .header { 
    display:flex; 
    align-items:center; 
    margin-bottom:28px; 
}

  .back-btn { 
    width:32px; 
    height:32px; 
    border-radius:50%; 
    border:none; 
    background:#f2f3f7; 
    font-size:18px; 
    cursor:pointer; 
    box-shadow:0 2px 6px rgba(0,0,0,0.04); 
}

  .header-title { 
    font-size:13px; 
    font-weight:500; 
    color:#555; 
}

  .avatar-wrapper { 
    display:flex; 
    justify-content:center; 
    margin-bottom:24px; 
}
  .avatar {
    width:160px;
    height:160px;
    border-radius:50%;
    border:2px solid #FF7A1A;
    overflow:hidden;
    display:inline-grid;
    place-items:center;
    position:relative;
    background: #fff;
    cursor:pointer;
  }
  .avatar-img {
    width:100%;
    height:100%;
    object-fit:cover;
    display:block;
  }
  .avatar-overlay {
    position:absolute;
    bottom:8px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.45);
    color:#fff;
    font-size:12px;
    padding:6px 10px;
    border-radius:12px;
    pointer-events:none;
  }
  .avatar input[type="file"] { 
    display:none; 
    }

  .form-group { 
    margin-bottom:20px; 
    }
  .form-label { 
    font-size:11px;
    letter-spacing:0.04em; 
    font-weight:500; 
    color:#555; 
    margin-bottom:6px; 
    text-transform:uppercase; 
}
  .form-control { 
    width:100%; 
    padding:12px 14px; 
    border-radius:8px; 
    border:none; 
    outline:none; 
    background:#F2F6FF; 
    font-size:13px; 
    color:#555; 
}

  .btn-submit { 
    width:100%; 
    padding:14px 0; 
    margin-top:28px; 
    border:none; 
    border-radius:8px; 
    background:#FFA000; 
    color:#fff; 
    font-weight:600; 
    font-size:14px; 
    cursor:pointer; 
    box-shadow:0 4px 10px rgba(255,160,0,0.4); 
}
  .btn-submit:active {
     transform:scale(0.98); 
    }

  .error { 
    color:#b00020; 
    font-size:12px; 
    margin-top:8px; 
    text-align:center; 
    display:none; 
    }
     
    .back-btn {
        top: 15px;
        left: 15px;
        width: 40px;
        height: 40px;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        color: #333;
        backdrop-filter: blur(4px)
    }
</style>
</head>
<body>
  <div class="screen">

    <div class="header">
     <a href="{{ url_for('pengguna.profil') }}" class="back-btn">‚Üê</a>
      <div class="header-title">Edit Profile</div>
    </div>

    <form action="{{ url_for('pengguna.editProfil') }}" method="POST" enctype="multipart/form-data">
        
        <div class="avatar-wrapper">
          <label class="avatar" title="Klik untuk ganti foto">
            
            {% if pengguna.IdPengguna %}
              <img id="preview" 
                   src="{{ url_for('pengguna.get_foto_profil', id=pengguna.IdPengguna) }}?v={{ range(1, 10000) | random }}" 
                   onerror="this.src='https://via.placeholder.com/150?text=No+Image'" 
                   alt="avatar" 
                   class="avatar-img">
            {% else %}
              <img id="preview" 
                   src="https://via.placeholder.com/150?text=Guest" 
                   alt="avatar" 
                   class="avatar-img">
            {% endif %}
        
            <div class="avatar-overlay">Ganti</div>
            <input type="file" id="fileInput" name="foto_profil" accept="image/*">
          </label>
        </div>

        <div id="error" class="error"></div>

        <div class="form-group">
          <div class="form-label">Username</div>
          <input class="form-control" name="nama" value="{{ pengguna.NamaPengguna }}" required />
        </div>

        <div class="form-group">
          <div class="form-label">Email</div>
          <input class="form-control" name="email" type="email" value="{{ pengguna.Email }}" required />
        </div>

        <div class="form-group">
          <div class="form-label">Nomor Telepon</div>
          <input class="form-control" name="no_telp" type="tel" value="{{ pengguna.NomorTelepon or '' }}" />
        </div>

        <button type="submit" class="btn-submit">SIMPAN</button>
    </form>
  </div>

<script>
  // Script preview gambar saat user memilih file baru (sebelum di-upload)
  const fileInput = document.getElementById('fileInput');
  const preview = document.getElementById('preview');
  
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      preview.src = URL.createObjectURL(file);
    }
  });
</script>
</body>
</html>